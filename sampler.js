(()=>{"use strict";var e,t,n={},o={};function l(e){var t=o[e];if(void 0!==t)return t.exports;var a=o[e]={exports:{}};return n[e](a,a.exports,l),a.exports}l.m=n,l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce((t,n)=>(l.f[n](e,t),t),[])),l.u=e=>e+".js",l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="nexia-nastrojovich:",l.l=(n,o,a,s)=>{if(e[n])e[n].push(o);else{var r,i;if(void 0!==a)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==t+a){r=d;break}}r||(i=!0,(r=document.createElement("script")).charset="utf-8",l.nc&&r.setAttribute("nonce",l.nc),r.setAttribute("data-webpack",t+a),r.src=n),e[n]=[o];var m=(t,o)=>{r.onerror=r.onload=null,clearTimeout(y);var l=e[n];if(delete e[n],r.parentNode&&r.parentNode.removeChild(r),l&&l.forEach(e=>e(o)),t)return t(o)},y=setTimeout(m.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=m.bind(null,r.onerror),r.onload=m.bind(null,r.onload),i&&document.head.appendChild(r)}},(()=>{var e;l.g.importScripts&&(e=l.g.location+"");var t=l.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),l.p=e})(),(()=>{var e={29:0};l.f.j=(t,n)=>{var o=l.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var a=new Promise((n,l)=>o=e[t]=[n,l]);n.push(o[2]=a);var s=l.p+l.u(t),r=new Error;l.l(s,n=>{if(l.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var a=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;r.message="Loading chunk "+t+" failed.\n("+a+": "+s+")",r.name="ChunkLoadError",r.type=a,r.request=s,o[1](r)}},"chunk-"+t,t)}};var t=(t,n)=>{var o,a,[s,r,i]=n,c=0;if(s.some(t=>0!==e[t])){for(o in r)l.o(r,o)&&(l.m[o]=r[o]);i&&i(l)}for(t&&t(n);c<s.length;c++)a=s[c],l.o(e,a)&&e[a]&&e[a][0](),e[a]=0},n=globalThis.webpackChunknexia_nastrojovich=globalThis.webpackChunknexia_nastrojovich||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),(()=>{const e=[{controlRisk:"Nízké",inherentRisk:"Nízké",rmmLevel:"Nízké",analyticalTests:"Ano",controlTests:"Ano",factor:"0"},{controlRisk:"Nízké",inherentRisk:"Nízké",rmmLevel:"Nízké",analyticalTests:"Ano",controlTests:"Ne",factor:"Test kontrol Error"},{controlRisk:"Nízké",inherentRisk:"Nízké",rmmLevel:"Nízké",analyticalTests:"Ne",controlTests:"Ano",factor:"0.7"},{controlRisk:"Nízké",inherentRisk:"Nízké",rmmLevel:"Nízké",analyticalTests:"Ne",controlTests:"Ne",factor:"Test kontrol Error"},{controlRisk:"Nízké",inherentRisk:"Střední",rmmLevel:"Nízké",analyticalTests:"Ano",controlTests:"Ano",factor:"0"},{controlRisk:"Nízké",inherentRisk:"Střední",rmmLevel:"Nízké",analyticalTests:"Ano",controlTests:"Ne",factor:"Test kontrol Error"},{controlRisk:"Nízké",inherentRisk:"Střední",rmmLevel:"Nízké",analyticalTests:"Ne",controlTests:"Ano",factor:"1.1"},{controlRisk:"Nízké",inherentRisk:"Střední",rmmLevel:"Nízké",analyticalTests:"Ne",controlTests:"Ne",factor:"Test kontrol Error"},{controlRisk:"Nízké",inherentRisk:"Vysoké",rmmLevel:"Střední",analyticalTests:"Ano",controlTests:"Ano",factor:"0.7"},{controlRisk:"Nízké",inherentRisk:"Vysoké",rmmLevel:"Střední",analyticalTests:"Ano",controlTests:"Ne",factor:"Test kontrol Error"},{controlRisk:"Nízké",inherentRisk:"Vysoké",rmmLevel:"Střední",analyticalTests:"Ne",controlTests:"Ano",factor:"1.6"},{controlRisk:"Nízké",inherentRisk:"Vysoké",rmmLevel:"Střední",analyticalTests:"Ne",controlTests:"Ne",factor:"Test kontrol Error"},{controlRisk:"Střední",inherentRisk:"Nízké",rmmLevel:"Nízké",analyticalTests:"Ano",controlTests:"Ano",factor:"0.7"},{controlRisk:"Střední",inherentRisk:"Nízké",rmmLevel:"Nízké",analyticalTests:"Ano",controlTests:"Ne",factor:"Test kontrol Error"},{controlRisk:"Střední",inherentRisk:"Nízké",rmmLevel:"Nízké",analyticalTests:"Ne",controlTests:"Ano",factor:"1.4"},{controlRisk:"Střední",inherentRisk:"Nízké",rmmLevel:"Nízké",analyticalTests:"Ne",controlTests:"Ne",factor:"Test kontrol Error"},{controlRisk:"Střední",inherentRisk:"Střední",rmmLevel:"Střední",analyticalTests:"Ano",controlTests:"Ano",factor:"1.1"},{controlRisk:"Střední",inherentRisk:"Střední",rmmLevel:"Střední",analyticalTests:"Ano",controlTests:"Ne",factor:"Test kontrol Error"},{controlRisk:"Střední",inherentRisk:"Střední",rmmLevel:"Střední",analyticalTests:"Ne",controlTests:"Ano",factor:"1.8"},{controlRisk:"Střední",inherentRisk:"Střední",rmmLevel:"Střední",analyticalTests:"Ne",controlTests:"Ne",factor:"Test kontrol Error"},{controlRisk:"Střední",inherentRisk:"Vysoké",rmmLevel:"Střední",analyticalTests:"Ano",controlTests:"Ano",factor:"1.4"},{controlRisk:"Střední",inherentRisk:"Vysoké",rmmLevel:"Střední",analyticalTests:"Ano",controlTests:"Ne",factor:"Test kontrol Error"},{controlRisk:"Střední",inherentRisk:"Vysoké",rmmLevel:"Střední",analyticalTests:"Ne",controlTests:"Ano",factor:"2.3"},{controlRisk:"Střední",inherentRisk:"Vysoké",rmmLevel:"Střední",analyticalTests:"Ne",controlTests:"Ne",factor:"Test kontrol Error"},{controlRisk:"Vysoké",inherentRisk:"Nízké",rmmLevel:"Nízké",analyticalTests:"Ano",controlTests:"Ano",factor:"Test kontrol Error"},{controlRisk:"Vysoké",inherentRisk:"Nízké",rmmLevel:"Nízké",analyticalTests:"Ano",controlTests:"Ne",factor:"1.1"},{controlRisk:"Vysoké",inherentRisk:"Nízké",rmmLevel:"Nízké",analyticalTests:"Ne",controlTests:"Ano",factor:"Test kontrol Error"},{controlRisk:"Vysoké",inherentRisk:"Nízké",rmmLevel:"Nízké",analyticalTests:"Ne",controlTests:"Ne",factor:"1.9"},{controlRisk:"Vysoké",inherentRisk:"Střední",rmmLevel:"Střední",analyticalTests:"Ano",controlTests:"Ano",factor:"Test kontrol Error"},{controlRisk:"Vysoké",inherentRisk:"Střední",rmmLevel:"Střední",analyticalTests:"Ano",controlTests:"Ne",factor:"1.4"},{controlRisk:"Vysoké",inherentRisk:"Střední",rmmLevel:"Střední",analyticalTests:"Ne",controlTests:"Ano",factor:"Test kontrol Error"},{controlRisk:"Vysoké",inherentRisk:"Střední",rmmLevel:"Střední",analyticalTests:"Ne",controlTests:"Ne",factor:"2.3"},{controlRisk:"Vysoké",inherentRisk:"Vysoké",rmmLevel:"Vysoké",analyticalTests:"Ano",controlTests:"Ano",factor:"Test kontrol Error"},{controlRisk:"Vysoké",inherentRisk:"Vysoké",rmmLevel:"Vysoké",analyticalTests:"Ano",controlTests:"Ne",factor:"1.9"},{controlRisk:"Vysoké",inherentRisk:"Vysoké",rmmLevel:"Vysoké",analyticalTests:"Ne",controlTests:"Ano",factor:"Test kontrol Error"},{controlRisk:"Vysoké",inherentRisk:"Vysoké",rmmLevel:"Vysoké",analyticalTests:"Ne",controlTests:"Ne",factor:"3"}],t={Ne:"Vysoké","Ano-8":"Střední","Ano-23":"Nízké"},n={Vysoké:{Vysoké:"Vysoké",Střední:"Střední",Nízké:"Nízké"},Střední:{Vysoké:"Střední",Střední:"Střední",Nízké:"Nízké"},Nízké:{Vysoké:"Střední",Střední:"Nízké",Nízké:"Nízké"}},o={Audit:{Vysoké:{Vysoké:{Vysoké:{Ano:1.9,Ne:3}},Střední:{Střední:{Ano:1.4,Ne:2.3}},Nízké:{Nízké:{Ano:1.1,Ne:1.9}}},Střední:{Vysoké:{Střední:{Ano:1.4,Ne:2.3}},Střední:{Střední:{Ano:1.1,Ne:1.9}},Nízké:{Nízké:{Ano:.7,Ne:1.4}}},Nízké:{Vysoké:{Střední:{Ano:.7,Ne:1.6}},Střední:{Nízké:{Ano:"Vzorek není potřeba, podle metodiky je FS nulové",Ne:1.1}},Nízké:{Nízké:{Ano:"Vzorek není potřeba, podle metodiky je FS nulové",Ne:.7}}}},"Přezkum hospodaření":{Vysoké:{Vysoké:{Vysoké:{Ano:1.1,Ne:1.7}},Střední:{Střední:{Ano:.8,Ne:1.3}},Nízké:{Nízké:{Ano:.6,Ne:1.1}}},Střední:{Vysoké:{Střední:{Ano:.8,Ne:1.3}},Střední:{Střední:{Ano:.6,Ne:1.1}},Nízké:{Nízké:{Ano:.4,Ne:.8}}},Nízké:{Vysoké:{Střední:{Ano:.4,Ne:.9}},Střední:{Nízké:{Ano:"Vzorek není potřeba, podle metodiky je FS nulové",Ne:.6}},Nízké:{Nízké:{Ano:"Vzorek není potřeba, podle metodiky je FS nulové",Ne:.4}}}}};function a(e,t){try{return n?.[e]?.[t]||null}catch(e){return null}}function s(t,n=e){const l=function(e){if(!(e&&e.engagementType&&e.controlRisk&&e.inherentRisk&&e.analyticalTests))return null;const t=e.rmmLevel||a(e.controlRisk,e.inherentRisk);if(!t)return null;try{const n=o?.[e.engagementType]?.[""+e.controlRisk]?.[""+e.inherentRisk]?.[""+t]?.[""+e.analyticalTests];return"number"==typeof n&&Number.isFinite(n)||"string"==typeof n&&"Vzorek není potřeba, podle metodiky je FS nulové"===n?n:null}catch(e){return null}}(t);if(null!==l)return l;if(Array.isArray(n)){const e=n.filter(e=>e.controlRisk===t.controlRisk&&e.inherentRisk===t.inherentRisk&&e.rmmLevel===(t.rmmLevel||a(t.controlRisk,t.inherentRisk))&&e.analyticalTests===t.analyticalTests);for(const t of e){const e=Number(String(t.factor).replace(",","."));if(Number.isFinite(e))return e}}return null}const r=e;let i={confidence:95,expectedError:5,populationSize:1e3},c=!1,u=null,d=null,m=null,y=null,v="",g="";const k="Vzorek není potřeba";let p={isActive:!1,cancelled:!1,currentChunk:0,totalChunks:0,startTime:null,operation:""},f=5e3,h=[];function b(e,t){const n=document.getElementById("progress-container"),o=document.getElementById("progress-title"),l=document.getElementById("progress-bar"),a=document.getElementById("progress-text"),s=document.getElementById("progress-eta");if(n&&o){p.isActive=!0,p.cancelled=!1,p.currentChunk=0,p.totalChunks=0,p.startTime=Date.now(),p.operation=t,o.textContent=e,l.style.width="0%",a.textContent="Příprava...",s.textContent="",n.style.display="block";const r=document.getElementById("progress-cancel");r&&(r.onclick=()=>{p.cancelled=!0,E(),_("Operace byla zrušena.")})}}function I(e,t,n=""){if(!p.isActive)return;const o=document.getElementById("progress-bar"),l=document.getElementById("progress-text"),a=document.getElementById("progress-eta");p.currentChunk=e,p.totalChunks=t;const s=t>0?e/t*100:0;if(o&&(o.style.width=`${Math.min(s,100)}%`),l){const o=n||`Zpracováno ${e} z ${t} dávek`;l.textContent=o}if(a&&e>0&&t>0){const n=(t-e)/(e/(Date.now()-p.startTime));if(n>1e3&&n<3e5){const e=Math.round(n/1e3);a.textContent=`Zbývá ~${e}s`}}}function E(){const e=document.getElementById("progress-container");e&&(e.style.display="none"),p.isActive=!1,p.cancelled=!1}function N(){return p.cancelled}function S(e,t,n){const o=n/t;h.push({chunkSize:e,rate:o,timestamp:Date.now()}),h.length>10&&(h=h.slice(-10)),function(){if(h.length<3)return;const e=300*(h.reduce((e,t)=>e+t.rate,0)/h.length);f=Math.max(1e3,Math.min(1e4,Math.round(e)))}()}function z(e=null){return e&&e>1e5?Math.min(f,1e3):e&&e>5e4?Math.min(f,2e3):e&&e>1e4?f:e&&e<1e4?Math.max(f,5e3):f}function B(e){const t=document.getElementById(e);if(!t)return;const n=t.querySelector(".modal");if(!n)return;const o=n.querySelector("h3");if(!o)return;let l=!1,a=0,s=0,r=0,i=0;const c=(e,t,n)=>Math.max(t,Math.min(n,e)),u=e=>{if(!l)return;const t=e.clientX-a,o=e.clientY-s;let u=r+t,d=i+o;const m=window.innerWidth,y=window.innerHeight,v=n.getBoundingClientRect(),g=v.width,k=v.height;u=c(u,8,m-g-8),d=c(d,8,y-k-8),n.style.left=u+"px",n.style.top=d+"px"},d=()=>{l=!1,document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",d)};o.addEventListener("mousedown",e=>{l=!0;const t=n.getBoundingClientRect();n.style.transform="none";const o=document.documentElement,c=window.pageXOffset||o.scrollLeft||0,m=window.pageYOffset||o.scrollTop||0;r=t.left+c,i=t.top+m,n.style.left=r+"px",n.style.top=i+"px",a=e.clientX,s=e.clientY,document.addEventListener("mousemove",u),document.addEventListener("mouseup",d)})}function T(){try{localStorage.setItem("usageMode",JSON.stringify({mode:v,reason:g}))}catch(e){}}function w(){const e="TVS"===v,t=!v,n=!e&&!t,o=document.getElementById("statistical-reason-area");o&&(o.style.display="StatisticalTVS"===v?"block":"none");const l=document.getElementById("usage-mode-hint");l&&(l.style.display=v?"none":"block");const a=document.getElementById("section-method");a&&(a.style.display=e||"StatisticalTVS"===v?"block":"none");const s=document.getElementById("section-factor");s&&(s.style.display=e?"block":"none");const r=document.getElementById("section-significance");r&&(r.style.display=e?"block":"none");const i=document.getElementById("section-task4"),c=document.getElementById("section-task5"),u=document.getElementById("section-task6"),d=document.getElementById("results");i&&(i.style.display=t?"none":"block"),c&&(c.style.display=t?"none":"block"),u&&(u.style.display=t?"none":"block"),d&&(d.style.display=t?"none":d.style.display),t&&(a&&(a.style.display="none"),s&&(s.style.display="none"),r&&(r.style.display="none"));const m=document.getElementById("sampling-method"),y=document.getElementById("task6-method-display");m&&("ControlTest"===v?(m.value="random-number-generator",m.disabled=!0,y&&(y.value="Náhodný generátor čísel")):m.disabled=!1);const g=document.getElementById("set-reliability"),k=document.getElementById("fill-significance");g&&(g.disabled=n),k&&(k.disabled=n);const p=document.getElementById("select-column"),f=document.getElementById("task4-column-area"),h=document.getElementById("sampling-method")&&document.getElementById("sampling-method").value||"";if("TVS"===v)f&&(f.style.display="block"),p&&(p.disabled=!1);else if("StatisticalTVS"===v){const e="monetary-random-walk"===h;f&&(f.style.display=e?"block":"none"),p&&(p.disabled=!e)}else f&&(f.style.display="none"),p&&(p.disabled=!0);const b=document.getElementById("task5-compute-sum"),I=document.getElementById("task5-calc-size"),E=document.getElementById("task5-use-calculated"),N=document.getElementById("task5-override-area"),S=document.getElementById("task5-override-size"),z=document.getElementById("task5-override-reason"),B=document.getElementById("task5-result-display"),T=document.getElementById("task5-size-display"),w=document.getElementById("task5-sum-area"),x=document.getElementById("task5-size-area"),R=document.getElementById("task5-use-area"),A=document.getElementById("task5-ct-preset-area"),C=document.getElementById("task5-ct-preset");if(t)w&&(w.style.display="none"),x&&(x.style.display="none"),R&&(R.style.display="none"),N&&(N.style.display="none"),A&&(A.style.display="none"),b&&(b.disabled=!0),I&&(I.disabled=!0),E&&(E.disabled=!0),B&&(B.value=""),T&&(T.value="");else if(n){if(w&&(w.style.display="none"),x&&(x.style.display="none"),R&&(R.style.display="none"),b&&(b.disabled=!0),I&&(I.disabled=!0),E&&(E.value="no",E.disabled=!0),A&&(A.style.display="ControlTest"===v?"block":"none"),N){const e="StatisticalTVS"===v||"ControlTest"===v&&C&&"Jine"===C.value;N.style.display=e?"flex":"none",e&&(N.style.flexDirection="column")}if(B&&(B.value=""),T&&(T.value=""),"StatisticalTVS"===v){const e=document.getElementById("sampling-method"),t=e&&"monetary-random-walk"===e.value;w&&(w.style.display=t?"block":"none"),b&&(b.disabled=!t)}}else A&&(A.style.display="none"),w&&(w.style.display="block"),x&&(x.style.display="block"),R&&(R.style.display="flex"),b&&(b.disabled=!1),I&&(I.disabled=!1),E&&(E.disabled=!1,E.value=""),N&&(N.style.display="none"),C&&(C.value=""),S&&(S.value=""),z&&(z.value="");const M=document.getElementById("task6-exclude-over-significance"),L=document.getElementById("task6-compute-adjusted-sum"),j=document.getElementById("task6-param-sum-display"),P=document.getElementById("task6-count-area"),$=document.getElementById("task6-significance-area");t||n?($&&($.style.display="none"),M&&(M.value="",M.disabled=!0),L&&(L.disabled=!0),j&&(j.value=""),P&&(P.style.display="none")):($&&($.style.display="block"),M&&(M.disabled=!1),L&&(L.disabled=!1)),V()}function V(){const e=document.getElementById("task6-generate-sample");if(!e)return;if(!v)return e.disabled=!0,void(e.title="Vyberte nejprve profil použití");if("TVS"===v){const t=document.getElementById("task6-final-size-display");return void(0===(t?q(t.value):null)?(e.disabled=!0,e.title="Nelze generovat s velikostí vzorku 0"):(e.disabled=!1,e.title=""))}const t=document.getElementById("task5-override-size"),n=t?q(t.value):null,o=document.getElementById("task5-ct-preset"),l=o?o.value:"",a="StatisticalTVS"!==v||g&&g.trim().length>0,s="ControlTest"===v&&("8"===l||"23"===l||"Jine"===l&&null!==n&&n>0)||"ControlTest"!==v&&null!==n&&n>0&&a;e.disabled=!s,e.title=s?"":"StatisticalTVS"!==v||g&&""!==g.trim()?"Zadejte velikost vzorku > 0":"Vyplňte důvod a velikost vzorku > 0"}async function x(){const e=document.getElementById("reliability-modal");if(!e)return void _("Dialog není dostupný.");const t=document.getElementById("reliability-engagement-type"),n=document.getElementById("reliability-control-testing"),o=document.getElementById("reliability-control-risk"),l=document.getElementById("reliability-inherent-risk"),a=document.getElementById("reliability-rmm-level"),s=document.getElementById("reliability-analytical-tests");t&&(t.value=i.engagementType||""),n&&(n.value=i.controlTesting||""),o&&(o.value=i.controlRisk||""),l&&(l.value=i.inherentRisk||""),a&&(a.value=i.rmmLevel||""),s&&(s.value=i.analyticalTests||""),e.style.display="flex";try{const t=e.querySelector(".modal");t&&(t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)")}catch(e){}}function R(){try{["reliability-factor","significance-type-display","significance-value-display","significance-justification-display","sampling-method","data-range","value-column","task5-result-display","task5-size-display","task5-use-calculated","task5-override-size","task5-override-reason","task5-confirm-info","task6-method-display","task6-final-size-display","task6-exclude-over-significance","task6-param-sum-display","task6-significant-count-display","task6-seed","usage-mode-reason"].forEach(e=>{try{const t=document.getElementById(e);if(!t)return;t.tagName,t.value=""}catch(e){}});const e=document.getElementById("task5-override-area");e&&(e.style.display="none");const t=document.getElementById("task6-count-area");t&&(t.style.display="none");const n=document.getElementById("results");n&&(n.style.display="none");const o=document.getElementById("task6-print-preview");o&&o.classList.add("hidden"),["reliabilityConfig","significanceConfig","TotalSumABS","task6ExcludeOverSignificance","task6Seed"].forEach(e=>{try{localStorage.removeItem(e)}catch(e){}}),i={confidence:95,expectedError:5,populationSize:1e3},c=!1,u=null,d=null,m=null,C=null,v="",g="";try{localStorage.removeItem("usageMode")}catch(e){}const l=document.getElementById("usage-mode");l&&(l.value="");const a=document.getElementById("statistical-reason-area");a&&(a.style.display="none");try{const e=document.getElementById("sampling-method");e&&(e.value="");const t=document.getElementById("task6-method-display");t&&(t.value="<Vyberte>")}catch(e){}D(),w(),V(),_("Vzorkovič byl restartován.")}catch(e){console.error("Chyba při resetu Vzorkoviče:",e),_("Chyba při restartu Vzorkoviče.")}}async function A(){let e=!1;try{const t=document.getElementById("sampling-method"),n=t?t.value:null;"monetary-random-walk"===n?e=await async function(){try{const e=document.getElementById("data-range")&&document.getElementById("data-range").value,t=document.getElementById("value-column")&&document.getElementById("value-column").value;if("TVS"!==v&&"StatisticalTVS"!==v)return _("V tomto režimu je povolen pouze Náhodný generátor čísel."),!1;if(!e||!t)return _("Nejdříve vyberte oblast dat a sloupec (úloha 4)."),!1;const n=document.getElementById("task6-exclude-over-significance"),o=n&&"yes"===n.value;let l=null;try{const e=localStorage.getItem("significanceConfig");if(e){const t=JSON.parse(e);t&&void 0!==t.rawValue&&null!==t.rawValue&&(l=Number(t.rawValue))}}catch(e){}if("TVS"===v&&o&&(null===l||Number.isNaN(l)))return _("Není nastavena významnost, přepněte nebo uložte hladinu významnosti (úloha 3)."),!1;let a=d||null;if(!a){const e=document.getElementById("task5-size-display");if(e&&e.value){const t=q(e.value);null!==t&&(a=Math.ceil(t))}}if(0===a)return _('Velikost vzorku byla vypočtena na velikost "0". Důvodem může být nedostatečná absolutní suma populace nebo nulový faktor spolehlivosti',15e3),!1;if(!a||a<0)return _("Neexistuje validní velikost vzorku. Nejprve ji potvrďte v úloze 5."),!1;let s=null;try{const e=document.getElementById("task6-param-sum-display");if(e&&e.value){const t=q(e.value);null!==t&&(s=t)}}catch(e){}return null===s&&(s=u),await Excel.run(async n=>{const r=n.workbook.worksheets.getActiveWorksheet();let i=e;-1!==i.indexOf("!")&&(i=i.split("!").pop()),i=i.replace(/\$/g,"").trim();const c=r.getRange(i);c.load(["values","rowIndex","columnIndex","rowCount","columnCount"]),await n.sync();const u=c.values,d=F(String(t).toUpperCase())-("number"==typeof c.columnIndex?c.columnIndex:0),m=c.rowCount||(u?u.length:0);if(!Array.isArray(u)||u.length<=1||d<0||d>=(u[0]?u[0].length:0))return _("Zadaný sloupec není v rámci vybraného rozsahu dat."),!1;if((null===s||Number.isNaN(s))&&(s=Y(u,d)),!s||Number.isNaN(s)||s<=0)return _("TotalSum je nula nebo neplatná."),!1;const v=s/a;if(!isFinite(v)||v<=0)return _("Neplatný krok (krok <= 0)."),!1;const g=X(),k=("function"==typeof g?g():Math.random())*v,p=new Array(a);for(let e=0;e<a;e++)p[e]=k+e*v;let f=0;const h=new Array(m);h[0]=["ABS","Kumulace ABS","Index/krok","Výběr","Důvod"];const N=z(m),S=m>N;S&&b("Generování NPP vzorku","process");let B=0;const T=Math.ceil((m-1)/N);let w=0;const V=new Array(m),x=new Array(m),R=new Array(m),A=new Array(m);for(let e=0;e<m;e++)R[e]="Ne",A[e]="";for(let e=1;e<m;e+=N){S&&(B++,I(B,T,`Zpracovávám dávku ${B}/${T}`));const t=Math.min(e+N,m);for(let n=e;n<t;n++){const e=q(u[n][d]),t=null===e?0:Math.abs(e);V[n]=t;let a=t;o&&null!==l&&t>l&&(a=0,R[n]="Ano - významnost",A[n]="přesah významnosti"),x[n]=a}}let C=0;for(let e=1;e<m;e++){const t=V[e]||0,n=1===e?k:C,o=n+(x[e]||0),l=Math.floor(n/v),a=Math.floor(o/v);let s=Math.max(0,a-l);s>0&&f+s>p.length&&(s=Math.max(0,p.length-f)),s>0&&(f+=s,"Ano - významnost"===R[e]?(R[e]="Ano - významnost; Ano - NPP",A[e]=A[e]?A[e]+"; NPP":"NPP"):(R[e]=1===s?"Ano - NPP":`Ano - NPP (x${s})`,A[e]="NPP"),w+=s),C=o;const r=C/v;h[e]=[t,C,r,R[e],A[e]]}const M=m,L=c.columnIndex+c.columnCount;r.getRangeByIndexes(c.rowIndex,L,M,5).values=h,r.getRangeByIndexes(c.rowIndex,L,1,5).format.font.bold=!0,await n.sync(),S&&E();const j=y||document.getElementById("task6-seed")&&document.getElementById("task6-seed").value||"";_("Generování dokončeno. Výsledky jsou vloženy do listu."+(j?` Použit seed: ${j}`:""))}),!0}catch(e){return console.error("Chyba v generateMonetaryRandomWalkTask6:",e),_("Chyba při generování mon. random walk: "+(e&&e.message?e.message:"")),!1}}():"random-number-generator"===n?e=await async function(){try{const e=document.getElementById("data-range")&&document.getElementById("data-range").value,t=document.getElementById("value-column")&&document.getElementById("value-column").value;if(!e)return _("Nejdříve vyberte oblast dat (úloha 4)."),!1;const n=document.getElementById("task6-exclude-over-significance"),o=n&&"yes"===n.value;let l=null;try{const e=localStorage.getItem("significanceConfig");if(e){const t=JSON.parse(e);t&&void 0!==t.rawValue&&null!==t.rawValue&&(l=Number(t.rawValue))}}catch(e){}if("TVS"===v&&o&&(null===l||Number.isNaN(l)))return _("Není nastavena významnost, přepněte nebo uložte hladinu významnosti (úloha 3)."),!1;let a=d||null;if(!a){const e=document.getElementById("task5-size-display");if(e&&e.value){const t=q(e.value);null!==t&&(a=Math.ceil(t))}}return 0===a?(_('Velikost vzorku byla vypočtena na velikost "0". Důvodem může být nedostatečná absolutní suma populace nebo nulový faktor spolehlivosti',15e3),!1):!a||a<0?(_("Neexistuje validní velikost vzorku. Nejprve ji potvrďte v úloze 5."),!1):(await Excel.run(async n=>{const s=n.workbook.worksheets.getActiveWorksheet();let r=e;-1!==r.indexOf("!")&&(r=r.split("!").pop()),r=r.replace(/\$/g,"").trim();const i=s.getRange(r);i.load(["values","rowIndex","columnIndex","rowCount","columnCount"]),await n.sync();const c=i.values;let u=-1;const d=document.getElementById("sampling-method"),m=d&&"monetary-random-walk"===d.value;("TVS"===v||"StatisticalTVS"===v&&m)&&(u=F(String(t).toUpperCase())-("number"==typeof i.columnIndex?i.columnIndex:0));const g=i.rowCount||(c?c.length:0);if(!Array.isArray(c)||c.length<=1)return _("Datová oblast neobsahuje žádné data."),!1;if(("TVS"===v||"StatisticalTVS"===v&&m)&&(u<0||u>=(c[0]?c[0].length:0)))return _("Zadaný sloupec není v rámci vybraného rozsahu dat."),!1;const k=Math.max(0,g-1);if(0===k)return _("Datová oblast neobsahuje žádné řádky."),!1;const p=k/a;if(!isFinite(p)||p<=0)return _("Neplatný krok (krok <= 0)."),!1;const f=X(),h=("function"==typeof f?f():Math.random())*p,S=new Array(k).fill(0);for(let e=0;e<a;e++){let t=(h+e*p)%k;t<0&&(t+=k);const n=Math.floor(t);S[n]=(S[n]||0)+1}const B=i.columnIndex+i.columnCount,T=s.getRangeByIndexes(i.rowIndex,B,1,2);T.values=[["Pořadí","Výběr"]],T.format.font.bold=!0;const w=z(g),V=g>w;V&&b("Generování NGČ vzorku","process");const x=H(n,s,i,w);let R=0;const A=Math.ceil(g/w);for await(const{values:e,startRow:t}of x){if(N())return _("Generování bylo zrušeno."),!1;R++,V&&I(R,A,`Zpracovávám dávku ${R}/${A}`);const a=t===i.rowIndex,r=[];for(let n=a?1:0;n<e.length;n++){const a=t-i.rowIndex+n,s=a;let c=0;if("TVS"===v){const t=q(e[n][u]);c=null===t?0:Math.abs(t)}const d=a-1;let m="Ne";if("TVS"===v&&o&&null!==l&&c>l)m="Ano - významnost";else if(S[d]&&S[d]>0){const e=S[d];m=1===e?"Ano - NGČ":`Ano - NGČ (x${e})`}r.push([s,m])}const c=i.rowIndex+(a?1:t-i.rowIndex);await G(n,s,c,B,r,w)}V&&E(),await n.sync();const C=y||document.getElementById("task6-seed")&&document.getElementById("task6-seed").value||"";_("Generování (NGČ) dokončeno. Výsledky jsou vloženy do listu."+(C?` Použit seed: ${C}`:""))}),!0)}catch(e){return E(),console.error("Chyba v generateRandomNumberGeneratorTask6:",e),e.message&&e.message.includes("zrušena uživatelem")?_("Generování NGČ bylo zrušeno."):_("Chyba při generování NGČ: "+(e&&e.message?e.message:"")),!1}}():(await async function(){try{const e=document.getElementById("sampling-method").value,t=document.getElementById("data-range").value,n=document.getElementById("value-column").value;if(!t)return void _("Prosím vyberte oblast dat.");if(("TVS"===v||"StatisticalTVS"===v&&"monetary-random-walk"===e)&&!n)return void _("Prosím vyberte i sloupec hodnot.");if("ControlTest"===v&&"random-number-generator"!==e)return void _("V tomto režimu je povolen pouze Náhodný generátor čísel.");await Excel.run(async o=>{const l=o.workbook.worksheets.getActiveWorksheet();let a=t;-1!==a.indexOf("!")&&(a=a.split("!").pop()),a=a.replace(/\$/g,"").trim();const s=l.getRange(a);s.load(["rowIndex","columnIndex","rowCount","columnCount"]),await o.sync();let r=-1;if(("TVS"===v||"StatisticalTVS"===v&&"monetary-random-walk"===e)&&(r=F(String(n).toUpperCase())-("number"==typeof s.columnIndex?s.columnIndex:0),r<0||r>=s.columnCount))return void _("Zadaný sloupec není v rámci vybraného rozsahu dat.");const i=s.rowCount>z(),c=i?"Načítání dat pro vzorkování":null;let u,d=[],m=null;for await(const{values:e,batchNumber:t,totalBatches:n}of H(o,l,s,null,c)){if(N())return void _("Generování vzorku bylo zrušeno.");1===t?(m=e[0],d.push(m),d=d.concat(e.slice(1))):d=d.concat(e),!c&&n>1&&_(`Načítám dávku ${t}/${n}...`)}N()||(i&&(b("Generování vzorku","process"),I(1,2,"Zpracovávání dat...")),u="monetary-random-walk"===e?function(e,t){const n=e.slice(1).reduce((e,n)=>{const o=q(n[t]),l=null!==o?o:0;return e+Math.abs(l)},0),o=U(n);if(!o||o<1)return[];const l=n/o,a=[];let s=0;const r=X();let i=("function"==typeof r?r():Math.random())*l;for(let n=1;n<e.length;n++){const o=q(e[n][t]);s+=null!==o?Math.abs(o):0,s>=i&&(a.push({rowIndex:n,rowData:e[n],value:e[n][t],cumulativeValue:s}),i+=l)}return a.slice(0,o)}(d,r):function(e,t){const n=U(e.slice(1).reduce((e,n)=>{const o=q(n[t]),l=null!==o?o:0;return e+Math.abs(l)},0)),o=e.slice(1),l=[],a=new Set;for(;l.length<n&&l.length<o.length;){const e=X(),n=Math.floor(("function"==typeof e?e():Math.random())*o.length);a.has(n)||(a.add(n),l.push({rowIndex:n+1,rowData:o[n],value:o[n][t]}))}return l}(d,r),i&&I(2,2,"Finalizace výsledků..."),function(e,t){const n=document.getElementById("results"),o=document.getElementById("sample-info"),l=document.getElementById("sample-list");o.innerHTML=`\n    <strong>Celkem řádků:</strong> ${t}<br>\n    <strong>Velikost vzorku:</strong> ${e.length}<br>\n    <strong>Procento vzorku:</strong> ${(e.length/t*100).toFixed(2)}%\n  `;let a="<strong>Vybrané řádky:</strong><br>";e.forEach((e,t)=>{a+=`${t+1}. Řádek ${e.rowIndex+1}, Hodnota: ${e.value}<br>`}),l.innerHTML=a,n.style.display="block"}(u,d.length),await async function(e,t,n,o){try{t.getRange(n).format.fill.clear();for(const e of o){const o=n.split(":")[0].replace(/\d+/,(e.rowIndex+1).toString())+":"+n.split(":")[1].replace(/\d+/,(e.rowIndex+1).toString());t.getRange(o).format.fill.color="yellow"}await e.sync()}catch(e){console.log("Varování: Nepodařilo se zvýraznit řádky:",e.message)}}(o,l,t,u),i&&E(),_(`Vzorkování dokončeno. Vybráno ${u.length} položek.`))})}catch(e){E(),console.error("Chyba při generování vzorku:",e),e.message&&e.message.includes("zrušena uživatelem")?_("Generování vzorku bylo zrušeno."):_("Chyba při generování vzorku: "+(e&&e.message?e.message:""))}}(),e=!0)}catch(e){console.error("Chyba při spuštění generování vzorku z Task6:",e),_("Chyba při generování vzorku.")}}Office.onReady(e=>{if(e.host===Office.HostType.Excel){document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="flex";const e=document.getElementById("btn-back-launcher");e&&(e.onclick=()=>{window.location.href="launcher.html"});const n=document.getElementById("set-reliability");n&&(n.onclick=x);const o=document.getElementById("reset-sampler");o&&(o.onclick=R);const p=document.getElementById("select-range");p&&(p.onclick=J);const f=document.getElementById("select-column");f&&(f.onclick=W);const h=document.getElementById("usage-mode");h&&(h.onchange=()=>{v=h.value||"",w(),T()});const b=document.getElementById("usage-mode-reason");b&&(b.oninput=()=>{g=b.value||"",T(),V()});const I=document.getElementById("task5-override-size");I&&(I.oninput=()=>{V()});const E=document.getElementById("task5-compute-sum");E&&(E.onclick=oe);const N=document.getElementById("task5-calc-size");N&&(N.onclick=le);const S=document.getElementById("task5-use-calculated");S&&(S.onchange=ae);const z=document.getElementById("task5-confirm-size");z&&(z.onclick=se);const C=document.getElementById("task5-ct-preset");C&&(C.onchange=()=>{const e=C.value,t=document.getElementById("task5-override-area"),n=document.getElementById("task5-confirm-info");if("Jine"===e)t&&(t.style.display="flex",t.style.flexDirection="column");else if("8"===e||"23"===e){t&&(t.style.display="none"),d=parseInt(e,10),m="Předvolba testu kontrol";const o=document.getElementById("task6-final-size-display");o&&(o.value=String(d)),n&&(n.textContent=""),_("Velikost vzorku pro test kontrol nastavena."),V()}else{t&&(t.style.display="none"),d=null;const e=document.getElementById("task6-final-size-display");e&&(e.value=""),n&&(n.textContent=""),V()}});const L=document.getElementById("sampling-method");L&&(L.onchange=()=>{const e=document.getElementById("task6-method-display");e&&(e.value=L.options[L.selectedIndex].text);try{w()}catch(e){}});try{const e=document.getElementById("task6-method-display"),t=document.getElementById("sampling-method");e&&t&&(e.value=t.options[t.selectedIndex].text),e&&"ControlTest"===v&&(e.value="Náhodný generátor čísel")}catch(e){}const F=document.getElementById("task6-exclude-over-significance");F&&(F.onchange=e=>{try{!function(e){try{localStorage.setItem("task6ExcludeOverSignificance",String(e))}catch(e){console.warn("Nelze uložiť volbu Task6 do storage:",e&&e.message?e.message:e)}}(F.value)}catch(e){console.warn("Nelze uložit volbu v Task6:",e)}});try{!function(){try{const e=localStorage.getItem("task6ExcludeOverSignificance"),t=document.getElementById("task6-exclude-over-significance");if(!t)return;if(!e)return void(t.value="");t.value=e}catch(e){console.warn("Nelze načíst volbu Task6 z storage:",e&&e.message?e.message:e)}}()}catch(e){}const G=document.getElementById("task6-compute-adjusted-sum");G&&(G.onclick=P);const H=document.getElementById("task6-generate-sample");H&&(H.onclick=A);const U=document.getElementById("task6-select-cell");U&&(U.onclick=M);const Y=document.getElementById("task6-generate-parameters");Y&&(Y.onclick=j);const q=document.getElementById("task6-seed");q&&(q.onchange=()=>{try{K(q.value)}catch(e){console.warn(e)}});try{!function(){try{const e=localStorage.getItem("task6Seed"),t=document.getElementById("task6-seed");e&&t&&(t.value=e,y=e)}catch(e){console.warn("Nelze načíst seed:",e)}}()}catch(e){}try{!function(){try{const e=localStorage.getItem("usageMode");if(!e)return;const t=JSON.parse(e);if(!t)return;v=t.mode||"",g=t.reason||"";const n=document.getElementById("usage-mode");n&&(n.value=v);const o=document.getElementById("statistical-reason-area"),l=document.getElementById("usage-mode-reason");"StatisticalTVS"===v?(o&&(o.style.display="block"),l&&(l.value=g)):o&&(o.style.display="none")}catch(e){}}()}catch(e){}w();const X=document.getElementById("task6-generate-seed"),re=document.getElementById("task6-regenerate-seed");X&&(X.onclick=()=>{const e=`${Date.now().toString(36)}-${Math.floor(1e6*Math.random()).toString(36)}`;try{document.getElementById("task6-seed").value=e,K(e),_("Seed vygenerován.")}catch(e){console.warn(e)}}),re&&(re.onclick=()=>{try{l.e(186).then(l.bind(l,89186)).then(e=>{const t=e.SEED_NAMES,n=t[Math.floor(Math.random()*t.length)];document.getElementById("task6-seed").value=n,K(n),_("Seed znovu vybrán ze seznamu.")})}catch(e){console.warn(e)}});const ie=document.getElementById("fill-significance");ie&&(ie.onclick=Q);const ce=document.getElementById("significance-save-btn"),ue=document.getElementById("significance-cancel-btn"),de=document.getElementById("significance-reset-btn");ce&&(ce.onclick=ee),ue&&(ue.onclick=()=>{const e=document.getElementById("significance-modal");e&&(e.style.display="none")}),de&&(de.onclick=te);try{B("reliability-modal")}catch(e){}try{B("significance-modal")}catch(e){}!function(){try{const e=localStorage.getItem("reliabilityConfig");if(!e)return;const t=JSON.parse(e);if(!t)return;i.engagementType=t.engagementType||i.engagementType,i.controlTesting=t.controlTesting||i.controlTesting,i.controlRisk=t.controlRisk||i.controlRisk,i.inherentRisk=t.inherentRisk||i.inherentRisk,i.rmmLevel=t.rmmLevel||i.rmmLevel,i.analyticalTests=t.analyticalTests||i.analyticalTests,c=!0;const n=s(i,r),o=document.getElementById("reliability-factor");o&&(null!==n?(o.placeholder="",o.value=String(n),Z(o,String(n))):D())}catch(e){console.warn("Nelze načíst nastavení z localStorage:",e.message)}}(),D(),function(){try{const e=localStorage.getItem("significanceConfig");let t=null;try{t=e?JSON.parse(e):null}catch(e){t=null}const n=document.getElementById("significance-type-display"),o=document.getElementById("significance-value-display"),l=document.getElementById("significance-justification-display");t?(n&&(n.value=t.type||""),o&&(o.value=void 0!==t.rawValue&&null!==t.rawValue?ne(t.rawValue):""),l&&(l.value=t.justification||"")):(n&&(n.value="",n.placeholder="Typ významnosti"),o&&(o.value="",o.placeholder="Hodnota (bez deset.)"),l&&(l.value="",l.placeholder="Zdůvodnění / stav"))}catch(e){console.warn("Nelze načíst hladinu významnosti ze storage:",e.message)}}();try{!function(){try{const e=localStorage.getItem("TotalSumABS");if(!e)return;const t=JSON.parse(e);if(null!=t){u=t;const e=document.getElementById("task5-result-display");e&&(e.value=ne(Math.round(u)))}}catch(e){console.warn("Nelze načíst TotalSumABS:",e&&e.message?e.message:e)}}()}catch(e){}const me=document.getElementById("reliability-modal"),ye=document.getElementById("modal-save-btn"),ve=document.getElementById("modal-cancel-btn"),ge=document.getElementById("modal-reset-btn");ye&&(ye.onclick=O),ve&&(ve.onclick=()=>{me&&(me.style.display="none")}),ge&&(ge.onclick=$);const ke=document.getElementById("reliability-engagement-type"),pe=document.getElementById("reliability-control-testing"),fe=document.getElementById("reliability-control-risk"),he=document.getElementById("reliability-inherent-risk"),be=document.getElementById("reliability-rmm-level"),Ie=document.getElementById("reliability-analytical-tests"),Ee=document.getElementById("reliability-factor-preview"),Ne=()=>{if(!Ee)return;const e=ke?.value||"",t=pe?.value||"",n=fe?.value||"",o=he?.value||"",l=be?.value||"",a=Ie?.value||"";if(![e,t,n,o,l,a].every(e=>e&&""!==e))return Ee.value="Nejsou vyplněny všechny odpovědi",void(Ee.style.fontWeight="");const i=s({engagementType:e,controlTesting:t,controlRisk:n,inherentRisk:o,rmmLevel:l,analyticalTests:a},r);"number"==typeof i&&Number.isFinite(i)?(Ee.value=String(i),Ee.style.fontWeight=""):i===k?(Ee.value=k,Ee.style.fontWeight="700"):(Ee.value="—",Ee.style.fontWeight="")};pe&&fe&&(pe.onchange=()=>{const e=pe.value||"",n=t[e]||"";fe.value=n,n&&he&&he.value&&(be.value=a(n,he.value)||""),Ne()}),he&&fe&&be&&(he.onchange=()=>{const e=fe.value||"",t=he.value||"";be.value=e&&t&&a(e,t)||"",Ne()}),ke&&(ke.onchange=Ne),Ie&&(Ie.onchange=Ne),Ne()}});let C=null;async function M(){try{await Excel.run(async e=>{const t=e.workbook.getSelectedRange();t.load("address, rowIndex, columnIndex"),await e.sync(),C={address:t.address,rowIndex:t.rowIndex,columnIndex:t.columnIndex};const n=ie(ce()).length,o=C.rowIndex+n-1,l=C.columnIndex+2-1,a=L(C.columnIndex),s=L(l),r=`${a}${C.rowIndex+1}:${s}${o+1}`;document.getElementById("task6-print-range-text").textContent=r,document.getElementById("task6-print-preview").classList.remove("hidden"),_("Buňka vybrána: "+C.address)})}catch(e){console.error("Chyba při výběru buňky:",e),_("Chyba při výběru buňky: "+e.message)}}function L(e){let t="",n=e;for(;n>=0;)t=String.fromCharCode(65+n%26)+t,n=Math.floor(n/26)-1;return t}async function j(){if(C)try{const e=ce(),t=await async function(e,t){if(!t)return _("Nejprve vyberte buňku pro tisk parametrů."),!1;try{let n=!1;return await Excel.run(async o=>{const l=o.workbook.worksheets.getActiveWorksheet(),a=ie(e),s=t.rowIndex,r=t.columnIndex;l.getRangeByIndexes(s,r,a.length,2).values=a;let i=a.findIndex(e=>e[0]&&e[0].toLowerCase().includes("autor vzorku"));if(i>-1){const e=l.getCell(s+i,r+1);e.format.fill.color="#fff200",e.format.font.bold=!0}await o.sync(),n=!0}),n}catch(e){return console.error("Chyba při tisku parametrů do buňky:",e),_("Chyba při tisku parametrů: "+e.message),!1}}(e,C);_(t?"Parametry byly vygenerovány.":"Parametry nebyly vloženy. Zkontrolujte oblast dat a aktivní list.")}catch(e){console.error("Chyba při generování parametrů:",e),_("Chyba při generování parametrů.")}else _("Nejprve vyberte buňku pro tisk parametrů.")}async function P(){try{if("TVS"!==v)return void _("Upravená suma je dostupná pouze v režimu TVS.");const e=document.getElementById("data-range").value,t=document.getElementById("value-column").value,n=document.getElementById("task6-param-sum-display"),o=document.getElementById("task6-count-area"),l=document.getElementById("task6-significant-count-display");if(!e||!t)return _("Prosím nejprve vyberte oblast dat a sloupec (úloha 4)."),n&&(n.value=""),void(o&&(o.style.display="none"));const a=document.getElementById("task6-exclude-over-significance"),s=a&&"yes"===a.value;let r=null;try{const e=localStorage.getItem("significanceConfig");if(e){const t=JSON.parse(e);t&&void 0!==t.rawValue&&null!==t.rawValue&&(r=Number(t.rawValue))}}catch(e){}await Excel.run(async a=>{const i=a.workbook.worksheets.getActiveWorksheet();let c=e;-1!==c.indexOf("!")&&(c=c.split("!").pop()),c=c.replace(/\$/g,"").trim();const d=i.getRange(c);d.load(["rowIndex","columnIndex","rowCount","columnCount"]),await a.sync();const m=F(String(t).toUpperCase())-("number"==typeof d.columnIndex?d.columnIndex:0);if(m<0||m>=d.columnCount)return _("Zadaný sloupec není v rámci vybraného rozsahu dat."),n&&(n.value=""),void(o&&(o.style.display="none"));let y=0,v=0;const g=z(d.rowCount),k=d.rowCount>g;k&&b("Výpočet upravené sumy","process");const p=H(a,i,d,g);let f=0;const h=Math.ceil(d.rowCount/g);for await(const{values:e}of p){f++,k&&I(f,h,`Zpracovávám dávku ${f}/${h}`);for(let t=1;t<e.length;t++){const n=q(e[t][m]);if(null===n)continue;const o=Math.abs(n);s&&null!==r&&!Number.isNaN(r)?o<=r?y+=o:v+=1:y+=o}}if(k&&E(),s)n&&(n.value=ne(Math.ceil(y))),o&&(o.style.display="flex"),l&&(l.value=String(v));else{const e=null!=u?u:Math.ceil(y);n&&(n.value=ne(Math.round(e))),o&&(o.style.display="none")}_("Upravená suma spočítána.")})}catch(e){console.error("Chyba při výpočtu upravené sumy:",e),_("Chyba při výpočtu upravené sumy.")}}function $(){try{localStorage.removeItem("reliabilityConfig"),delete i.engagementType,delete i.controlTesting,delete i.controlRisk,delete i.inherentRisk,delete i.analyticalTests,delete i.rmmLevel,c=!1;const e=document.getElementById("reliability-control-risk"),t=document.getElementById("reliability-inherent-risk"),n=document.getElementById("reliability-analytical-tests"),o=document.getElementById("reliability-engagement-type"),l=document.getElementById("reliability-control-testing"),a=document.getElementById("reliability-rmm-level"),s=document.getElementById("reliability-factor-preview");o&&(o.value=""),l&&(l.value=""),e&&(e.value=""),t&&(t.value=""),a&&(a.value=""),n&&(n.value=""),s&&(s.value="",s.style.fontWeight=""),D();const r=document.getElementById("reliability-modal");r&&(r.style.display="none"),_("Nastavení bylo resetováno.")}catch(e){console.error("Chyba při resetování:",e),_("Nepodařilo se resetovat nastavení.")}}function O(){try{const e=document.getElementById("reliability-modal"),n=document.getElementById("reliability-engagement-type"),o=document.getElementById("reliability-control-testing"),l=document.getElementById("reliability-control-risk"),u=document.getElementById("reliability-inherent-risk"),d=document.getElementById("reliability-rmm-level"),m=document.getElementById("reliability-analytical-tests"),y=l&&l.value?l.value:t[o?.value||""]||i.controlRisk,v=d&&d.value?d.value:a(y,u?.value||i.inherentRisk),g={engagementType:n?.value||i.engagementType,controlTesting:o?.value||i.controlTesting,controlRisk:y,inherentRisk:u?.value||i.inherentRisk,rmmLevel:v,analyticalTests:m?.value||i.analyticalTests};if(!(g.engagementType&&g.controlTesting&&g.inherentRisk&&g.analyticalTests))return void _("Prosím vyplň všechna povinná pole.");i={...i,...g},c=!0,function(){try{const e={engagementType:i.engagementType,controlTesting:i.controlTesting,controlRisk:i.controlRisk,inherentRisk:i.inherentRisk,analyticalTests:i.analyticalTests,rmmLevel:i.rmmLevel};localStorage.setItem("reliabilityConfig",JSON.stringify(e))}catch(e){console.warn("Nelze uložit nastavení do localStorage:",e.message)}}(),D();const p=s(i,r),f=document.getElementById("reliability-factor"),h=document.getElementById("reliability-factor-preview");f&&(null!==p?(f.placeholder="",f.value=String(p),Z(f,String(p)),h&&(h.value=String(p),h.style.fontWeight=String(p)===k?"700":"")):(f.value="",f.placeholder="<Nevyplněno>",Z(f,null),h&&(h.value="",h.style.fontWeight=""))),e&&(e.style.display="none")}catch(e){console.error("Chyba při ukládání nastavení spolehlivosti:",e),_("Došlo k neočekávané chybě při ukládání.")}}function D(){const e=document.getElementById("reliability-factor");if(!c)return e.value="",e.placeholder="<Nevyplněno>",e.style.color="",void(e.style.fontWeight="");const t=`Činnost: ${i.engagementType||"-"}, Testy kontrol: ${i.controlTesting||"-"}, Kontrolní riziko: ${i.controlRisk||"-"}, Přirozené riziko: ${i.inherentRisk||"-"}, Hladina RMM: ${i.rmmLevel||"-"}, Analytické testy: ${i.analyticalTests||"-"}`;e.placeholder="",e.value=t,e.style.color="",e.style.fontWeight=""}function Z(e,t){e&&("Test kontrol Error"===t?(e.style.color="red",e.style.fontWeight="700"):t===k?(e.style.color="",e.style.fontWeight="700"):(e.style.color="",e.style.fontWeight=""))}async function J(){try{await Excel.run(async e=>{const t=e.workbook.getSelectedRange();t.load("address"),await e.sync(),document.getElementById("data-range").value=t.address,console.log(`Vybrán rozsah: ${t.address}`)})}catch(e){console.error("Chyba při výběru rozsahu:",e),_("Chyba při výběru rozsahu. Ujistěte se, že máte vybraný rozsah v Excelu.")}}async function W(){try{await Excel.run(async e=>{const t=e.workbook.getSelectedRange();t.load(["columnIndex"]),await e.sync();const n=function(e){let t="",n=e+1;for(;n>0;){let e=(n-1)%26;t=String.fromCharCode(65+e)+t,n=Math.floor((n-1)/26)}return t}(t.columnIndex);document.getElementById("value-column").value=n,console.log(`Vybrán sloupec: ${n}`)})}catch(e){console.error("Chyba při výběru sloupce:",e),_("Chyba při výběru sloupce. Ujistěte se, že máte vybranou buňku v Excelu.")}}function F(e){if(!isNaN(e))return parseInt(e)-1;let t=0;for(let n=0;n<e.length;n++)t=26*t+(e.charCodeAt(n)-"A".charCodeAt(0)+1);return t-1}async function G(e,t,n,o,l,a=null,s=null){const r=a||z(l.length),i=Math.ceil(l.length/r);s&&i>1&&b(s,"write");for(let a=0;a<l.length;a+=r){if(N())throw new Error("Operace byla zrušena uživatelem");const c=Date.now(),u=l.slice(a,a+r),d=u.length;t.getRangeByIndexes(n+a,o,d,u[0].length).values=u,await e.sync(),S(r,Date.now()-c,d);const m=Math.floor(a/r)+1;s&&i>1&&I(m,i,`Zapisuji dávku ${m}/${i}`)}s&&i>1&&E()}async function*H(e,t,n,o=null,l=null){const a=n.rowCount,s=n.rowIndex,r=n.columnIndex,i=n.columnCount,c=o||z(a),u=Math.ceil(a/c);l&&u>1&&b(l,"read");for(let n=0;n<a;n+=c){if(N())throw new Error("Operace byla zrušena uživatelem");const o=Date.now(),d=Math.min(c,a-n),m=t.getRangeByIndexes(s+n,r,d,i);m.load("values"),await e.sync(),S(c,Date.now()-o,d);const y=Math.floor(n/c)+1;l&&u>1&&I(y,u,`Načítám dávku ${y}/${u}`),yield{values:m.values,startRow:s+n,batchNumber:y,totalBatches:u}}l&&u>1&&E()}function U(e){let t=null;try{const e=document.getElementById("reliability-factor");if(e&&e.value)if(e.value===k)t=0;else{const n=q(e.value);null!==n&&(t=n)}}catch(e){}if(null===t||Number.isNaN(t)){const e=s(i,r);"number"!=typeof e||Number.isNaN(e)?e===k&&(t=0):t=e}let n=null;try{const e=localStorage.getItem("significanceConfig");if(e){const t=JSON.parse(e);if(t&&"number"==typeof t.rawValue)n=t.rawValue;else if(t&&t.rawValue){const e=q(t.rawValue);null!==e&&(n=e)}}}catch(e){}if("number"==typeof e&&!Number.isNaN(e)&&null!==t&&n&&n>0){const o=e*t/n,l=Math.ceil(o);return Math.max(0,l)}try{const{confidence:e,expectedError:t,populationSize:n}=i,o=95===e?1.96:99===e?2.58:1.645,l=.5,a=t/100;let s=o*o*l*(1-l)/(a*a);return n>0&&(s/=1+(s-1)/n),Math.ceil(s)}catch(e){return 1}}function Y(e,t){return!Array.isArray(e)||e.length<=1?0:e.slice(1).reduce((e,n)=>{const o=q(n&&n.length>t?n[t]:null);return null===o?e:e+Math.abs(o)},0)}function q(e){if(null==e)return null;let t=String(e).trim();if(""===t)return null;t=t.replace(/\s+/g,""),t=-1!==t.indexOf(",")&&-1===t.indexOf(".")?t.replace(",","."):t.replace(/,/g,""),t=t.replace(/[^0-9.\-]/g,"");const n=Number(t);return Number.isFinite(n)?n:null}function K(e){try{localStorage.setItem("task6Seed",String(e)),y=e}catch(e){console.warn("Nelze uložit seed:",e)}}function X(){try{const t=y||document.getElementById("task6-seed")&&document.getElementById("task6-seed").value;if(!t&&0!==t)return null;const n=function(e){let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=Math.imul(t,16777619)>>>0;return t+=t<<13,t^=t>>>7,t+=t<<3,t^=t>>>17,t+=t<<5,t>>>0}(String(t));return e=n,function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}catch(e){return null}var e}function _(e,t=4e3){try{const n=document.getElementById("notification");if(!n)return;n.textContent=e,n.style.display="block",setTimeout(()=>{n.style.display="none"},t)}catch(t){console.log("Notifikace:",e)}}function Q(){const e=document.getElementById("significance-modal"),t=document.getElementById("significance-type"),n=document.getElementById("significance-value"),o=document.getElementById("significance-justification");if(!(e&&t&&n&&o))return void _("Dialog hladiny významnosti není dostupný.");const l=localStorage.getItem("significanceConfig");let a=null;try{a=l?JSON.parse(l):null}catch(e){a=null}a?(t.value=a.type||"",n.value=void 0!==a.rawValue&&null!==a.rawValue?String(a.rawValue):"",o.value=a.justification||""):(t.value="",n.value="",o.value=""),"Prováděcí"===t.value?(o.value="NEVYPLŇOVAT",o.readOnly=!0):(o.readOnly=!1,"NEVYPLŇOVAT"===o.value&&(o.value="")),t.onchange=()=>{"Prováděcí"===t.value?(o.value="NEVYPLŇOVAT",o.readOnly=!0):("NEVYPLŇOVAT"===o.value&&(o.value=""),o.readOnly=!1)};const s=e=>{!function(e){if(!e)return;const t=e.value,n=e.selectionStart;let o=t.replace(/%/g,"").replace(/[^0-9\-]/g,"");if(""===o||"-"===o||"+"===o)return void(e.value=o);const l=Math.abs(parseInt(o,10));if(Number.isNaN(l))return void(e.value="");const a=String(l).replace(/\B(?=(\d{3})+(?!\d))/g," ");let s=0;for(let e=0;e<n;e++)/[0-9]/.test(t[e])&&s++;let r=0,i=0;for(;r<a.length&&i<s;)/[0-9]/.test(a[r])&&i++,r++;e.value=a;try{e.setSelectionRange(r,r)}catch(e){}}(n)};n.removeEventListener("input",s),n.addEventListener("input",s),e.style.display="flex";try{const t=e.querySelector(".modal");t&&(t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)")}catch(e){}}function ee(){try{const e=document.getElementById("significance-type"),t=document.getElementById("significance-value"),n=document.getElementById("significance-justification");if(!e||!t||!n)return;const o=e.value||"";let l=t.value?t.value.trim():"",a=n.value?n.value.trim():"";if(!o)return void _("Prosím vyberte typ významosti.");if("Prováděcí"!==o&&!a)return void _('Pokud není zvoleno "Prováděcí", je potřeba zadat zdůvodnění.');let s=null;if(l){l=l.replace(/%/g,"");const e=l.replace(/[^0-9\-]/g,"");""!==e&&"-"!==e&&"+"!==e&&(s=parseInt(e,10),s=Number.isNaN(s)?null:Math.abs(s))}if(null===s)return void _("Prosím zadejte hodnotu hladiny významnosti jako celé číslo.");"Prováděcí"===o&&(a="NEVYPLŇOVAT");const r={type:o,rawValue:s,justification:a};localStorage.setItem("significanceConfig",JSON.stringify(r));const i=document.getElementById("significance-type-display"),c=document.getElementById("significance-value-display"),u=document.getElementById("significance-justification-display");i&&(i.value=o),c&&(c.value=ne(s)),u&&(u.value=a);const d=document.getElementById("significance-modal");d&&(d.style.display="none"),_("Hladina významnosti uložena.")}catch(e){console.error("Chyba při ukládání hladiny významnosti:",e),_("Nelze uložit hladinu významnosti.")}}function te(){try{localStorage.removeItem("significanceConfig");const e=document.getElementById("significance-type-display"),t=document.getElementById("significance-value-display"),n=document.getElementById("significance-justification-display");e&&(e.value="",e.placeholder="Typ významnosti"),t&&(t.value="",t.placeholder="Hodnota (bez deset.)"),n&&(n.value="",n.placeholder="Zdůvodnění / stav");const o=document.getElementById("significance-modal");o&&(o.style.display="none"),_("Hladina významnosti byla resetována.")}catch(e){console.error("Chyba při resetování hladiny významnosti:",e),_("Nelze resetovat hladinu významnosti.")}}function ne(e){return null==e?"":String(Math.round(e)).replace(/\B(?=(\d{3})+(?!\d))/g," ")}async function oe(){let e=null;try{const t=document.getElementById("data-range").value,n=document.getElementById("value-column").value;if(e=document.getElementById("task5-result-display"),!t||!n)return _("Prosím nejprve vyberte oblast dat a sloupec (úloha 4)."),void(e&&(e.value=""));await Excel.run(async o=>{const l=o.workbook.worksheets.getActiveWorksheet();let a=t;-1!==a.indexOf("!")&&(a=a.split("!").pop()),a=a.replace(/\$/g,"").trim();const s=l.getRange(a);s.load(["rowIndex","columnIndex","rowCount","columnCount"]),await o.sync();const r=F(String(n).toUpperCase())-("number"==typeof s.columnIndex?s.columnIndex:0);if(r<0||r>=s.columnCount)return _("Zadaný sloupec není v rámci vybraného rozsahu dat."),void(e&&(e.value=""));let i=0;const c=s.rowCount>z()?"Výpočet sumy":null;for await(const{values:t,batchNumber:n,totalBatches:a}of H(o,l,s,null,c)){if(N())return void(e&&(e.value=""));i+=Y(t,r),!c&&a>1&&_(`Zpracovává se dávka ${n}/${a}...`)}const d=Math.ceil(i);e&&(e.value=ne(d)),u=d;try{!function(e){try{localStorage.setItem("TotalSumABS",JSON.stringify(e))}catch(e){console.warn("Nelze uložit TotalSumABS:",e&&e.message?e.message:e)}}(u)}catch(e){}_("Suma byla spočítána.")})}catch(t){console.error("Chyba při výpočtu Task5 sumy:",t&&t.stack?t.stack:t);const n=t&&t.message?t.message:String(t);e&&(e.value=""),t.message&&t.message.includes("zrušena uživatelem")?_("Výpočet sumy byl zrušen."):_("Chyba při výpočtu sumy: "+n)}}function le(){try{const e=document.getElementById("task5-size-display");let t=null;const n=document.getElementById("reliability-factor");if(n&&n.value)if(n.value===k)t=0;else{const e=q(n.value);null!==e&&(t=e)}if(null===t||Number.isNaN(t)){const e=s(i,r);"number"!=typeof e||Number.isNaN(e)?e===k&&(t=0):t=e}let o=null;try{const e=localStorage.getItem("significanceConfig");if(e){const t=JSON.parse(e);if(t&&"number"==typeof t.rawValue)o=t.rawValue;else if(t&&t.rawValue){const e=q(t.rawValue);null!==e&&(o=e)}}}catch(e){}let l=u;if(null==l&&document.getElementById("task5-result-display")){const e=q(document.getElementById("task5-result-display").value);null!==e&&(l=e)}if(null===t||null===o||null===l||0===o)return e&&(e.value=""),void _("Pro výpočet velikosti vzorku musí být nastaven faktor, významnost a spočítaná suma.");const a=t*l/o,c=Math.ceil(a);e&&(e.value=String(c)),_("Velikost vzorku byla spočítána.")}catch(e){console.error("Chyba při výpočtu velikosti vzorku:",e&&e.stack?e.stack:e);const t=e&&e.message?e.message:String(e),n=document.getElementById("task5-size-display");n&&(n.value=""),_("Chyba při výpočtu velikosti vzorku: "+t)}}function ae(e){try{const e=document.getElementById("task5-use-calculated"),t=document.getElementById("task5-override-area"),n=document.getElementById("task5-override-size"),o=document.getElementById("task5-override-reason");if(!e||!t)return;"no"===e.value?(t.style.display="flex",t.style.flexDirection="column"):(t.style.display="none",n&&(n.value=""),o&&(o.value=""))}catch(e){console.error("Error handling Task5 use choice:",e)}}function se(){try{const e=document.getElementById("task5-use-calculated"),t=document.getElementById("task5-override-size"),n=document.getElementById("task5-override-reason"),o=document.getElementById("task5-confirm-info"),l=document.getElementById("task5-ct-preset");if(!e)return void _("Vyberte prosím, zda chcete použít vypočtenou velikost.");if("TVS"!==v){if("ControlTest"===v){const e=l?l.value:"";if(!e)return void _("Zvolte předvolbu velikosti (8/23/Jiné).");if("8"===e||"23"===e)d=parseInt(e,10),m="Předvolba testu kontrol";else{if(!t||!t.value)return void _("Zadejte prosím požadovanou velikost.");const e=q(t.value);if(null===e||e<=0)return void _("Žádaná velikost musí být kladné číslo.");d=Math.ceil(e),m=n&&n.value||""}}else{if(!t||!t.value)return void _("Zadejte prosím požadovanou velikost.");const e=q(t.value);if(null===e||e<=0)return void _("Žádaná velikost musí být kladné číslo.");d=Math.ceil(e),m=n&&n.value||""}o&&(o.textContent="");const e=document.getElementById("task6-final-size-display");return e&&(e.value=String(d)),_("Velikost vzorku potvrzena."),void V()}if("yes"===e.value){const e=document.getElementById("task5-size-display");if(!e||!e.value)return void _("Neexistuje vypočtená hodnota. Nejprve spočítejte velikost.");const t=q(e.value);if(null===t)return void _("Nelze načíst vypočtenou velikost z pole.");const n=Math.ceil(t);d=n,m="Použito vypočtené n",o&&(o.textContent="");const l=document.getElementById("task6-final-size-display");l&&(l.value=String(d));const a=document.getElementById("task6-method-display"),s=document.getElementById("sampling-method");return a&&s&&(a.value=s.options[s.selectedIndex].text),_("Velikost vzorku potvrzena (použito vypočtené)."),void(e&&(e.value=String(d)))}if("no"===e.value){if(!t||!t.value)return void _("Zadejte prosím požadovanou velikost.");const e=q(t.value);if(null===e||e<=0)return void _("Žádaná velikost musí být kladné číslo.");const l=Math.ceil(e);d=l,m=n&&n.value||"",o&&(o.textContent="");const a=document.getElementById("task6-final-size-display");return a&&(a.value=String(d)),void _("Žádaná velikost byla potvrzena a aplikována pouze do Úkolu 6.")}_("Vyberte prosím možnost Ano nebo Ne.")}catch(e){console.error("Chyba při potvrzení požadované velikosti:",e),_("Chyba při potvrzení velikosti.")}}function re(e){const t=document.getElementById(e);if(t){if("SELECT"===t.tagName)try{return t.options[t.selectedIndex].text}catch(e){return""}return t.value||""}return""}function ie(e){const t=[];t.push(["Parametry Vzorkoviče",""]);for(const n in e)if(Object.hasOwnProperty.call(e,n)){const o=e[n];t.push([n,null==o?"":o])}return t}function ce(){const e={};if(e["Účel generování vzorku"]=function(){const e=document.getElementById("usage-mode");if(!e)return v;const t=e.options[e.selectedIndex];return t?t.text:v}(),"StatisticalTVS"===v&&(e["Důvod pro předvolbu"]=g||re("usage-mode-reason")),"TVS"===v?(e["Činnost (typ zakázky)"]=i.engagementType||"",e["Testy kontrol (provedení)"]=i.controlTesting||"",e["Kontrolní riziko"]=i.controlRisk||"",e["Přirozené riziko"]=i.inherentRisk||"",e["Hladina RMM"]=i.rmmLevel||"",e["Provádím analytické testy?"]=i.analyticalTests||"",e["Faktor spolehlivosti (výsledný)"]=re("reliability-factor")):(e["Činnost (typ zakázky)"]="N/A (mimo TVS)",e["Testy kontrol (provedení)"]="N/A (mimo TVS)",e["Kontrolní riziko"]="N/A (mimo TVS)",e["Přirozené riziko"]="N/A (mimo TVS)",e["Hladina RMM"]="N/A (mimo TVS)",e["Provádím analytické testy?"]="N/A (mimo TVS)",e["Faktor spolehlivosti (výsledný)"]="N/A (mimo TVS)"),"TVS"===v?(e["Typ významnosti"]=re("significance-type-display"),e["Hodnota významnosti"]=re("significance-value-display"),e["Zdůvodnění významnosti"]=re("significance-justification-display")):(e["Typ významnosti"]="N/A (mimo TVS)",e["Hodnota významnosti"]="N/A (mimo TVS)",e["Zdůvodnění významnosti"]="N/A (mimo TVS)"),e["Oblast dat"]=re("data-range"),e["Sloupec pro výběr"]="TVS"===v?re("value-column"):"Nepovinné (mimo TVS)","TVS"===v){e["Celková suma absolutních hodnot"]=re("task5-result-display"),e["Vypočtená velikost vzorku"]=re("task5-size-display");const t=re("task5-use-calculated");e["Použít vypočtenou velikost"]=t,"Ne"===t&&(e["Uživatelská velikost vzorku"]=re("task5-override-size"),e["Důvod uživatelské velikosti"]=re("task5-override-reason"))}else{if(e["Celková suma absolutních hodnot"]="N/A (mimo TVS)",e["Vypočtená velikost vzorku"]="N/A (mimo TVS)",e["Použít vypočtenou velikost"]="N/A (mimo TVS)","ControlTest"===v){const t=function(){const e=document.getElementById("task5-ct-preset");return e?e.value:""}();e["Předvolba velikosti pro test kontrol"]=t?"Jine"===t?"Jiné":t:""}e["Uživatelská velikost vzorku"]=re("task5-override-size"),e["Důvod uživatelské velikosti"]=re("task5-override-reason")}e["Metoda výběru vzorku"]=re("task6-method-display");const t=re("task6-final-size-display");return e["Finální velikost vzorku"]=t,"TVS"===v?(e["Vyloučit nadlimitní položky"]=re("task6-exclude-over-significance"),e["Suma pro výpočet (po úpravě)"]=re("task6-param-sum-display"),e["Počet položek nad významností"]=re("task6-significant-count-display"),0===q(t)&&(e["Poznámka k velikosti vzorku"]="Vypočtená/finální velikost n=0 – vzorek není potřeba nebo nedostatečná suma")):(e["Vyloučit nadlimitní položky"]="N/A (mimo TVS)",e["Suma pro výpočet (po úpravě)"]="N/A (mimo TVS)",e["Počet položek nad významností"]="N/A (mimo TVS)"),e["Seed pro generátor"]=re("task6-seed"),e["Autor vzorku"]="Neznámý uživatel",e["Datum a čas vyhotovení"]=(new Date).toLocaleString(),e}})()})();
//# sourceMappingURL=sampler.js.map