(()=>{"use strict";(()=>{function e(e,t="info"){console.log(`[${t.toUpperCase()}] ${e}`);let n=document.getElementById("notification");n||(n=document.createElement("div"),n.id="notification",n.className="notification",document.body.appendChild(n)),n.className=`notification notification-${t}`,n.textContent=e,n.classList.remove("hidden"),setTimeout(()=>{n.classList.add("hidden")},4e3)}function t(e,t=0){return new Intl.NumberFormat("cs-CZ",{minimumFractionDigits:t,maximumFractionDigits:t}).format(e)}function n(){o={y3:null,y2:null,y1:null,y0:null},a=null,l=null;const t=(new Date).getFullYear();document.getElementById("accounting-period-start").value=`${t}-01-01`,document.getElementById("unit-name").value="",document.getElementById("unit-ico").value="",document.getElementById("unit-type").value="",c(),m(),document.getElementById("data-summary").classList.add("hidden"),document.getElementById("results-section").classList.add("hidden"),document.getElementById("print-section").classList.add("hidden"),document.getElementById("print-preview").classList.add("hidden"),e("Kontrola byla restartována","success")}let a=null,o={y3:null,y2:null,y1:null,y0:null},s=null,l=null;function r(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}function i(e){if(!e)return"";const[t,n,a]=e.split("-").map(e=>parseInt(e,10));return t&&n&&a?`${a}.${n}.${t}`:e}function c(){const e=document.getElementById("accounting-period-start");if(!e||!e.value)return;const[t,n,a]=e.value.split("-").map(e=>parseInt(e,10));if(!t)return;const s=1===n&&1===a?"Rok ":"FY";document.getElementById("year-label-3").textContent=`${s}${t-3}`,document.getElementById("year-label-2").textContent=`${s}${t-2}`,document.getElementById("year-label-1").textContent=`${s}${t-1}`,document.getElementById("year-label-0").textContent=`${s}${t}`,o={y3:null,y2:null,y1:null,y0:null},m(),v()}function y(t){s=t;const n=document.getElementById("accounting-period-start");if(!n||!n.value)return void e("Nejprve vyplňte první den účetního období","warning");const[a]=n.value.split("-").map(e=>parseInt(e,10));let l;if(l="y3"===t?a-3:"y2"===t?a-2:"y1"===t?a-1:a,document.getElementById("modal-year-title").textContent=`Vyplnit údaje pro rok ${l}`,o[t]){const e=o[t];document.getElementById("modal-aktiva").value=e.aktiva?r(e.aktiva):"",document.getElementById("modal-obrat").value=e.obrat?r(e.obrat):"",document.getElementById("modal-zamestnanci").value=e.zamestnanci?r(e.zamestnanci):"",document.getElementById("modal-zdroj").value=e.zdroj||""}else document.getElementById("modal-aktiva").value="",document.getElementById("modal-obrat").value="",document.getElementById("modal-zamestnanci").value="",document.getElementById("modal-zdroj").value="";document.getElementById("year-modal").classList.remove("hidden")}function d(){document.getElementById("year-modal").classList.add("hidden"),s=null}function u(){if(!s)return;const t=document.getElementById("modal-aktiva").value.replace(/\s/g,""),n=document.getElementById("modal-obrat").value.replace(/\s/g,""),a=document.getElementById("modal-zamestnanci").value.replace(/\s/g,""),l=parseFloat(t)||0,r=parseFloat(n)||0,i=parseFloat(a)||0,c=document.getElementById("modal-zdroj").value.trim();0!==l||0!==r||0!==i?c?(o[s]={aktiva:l,obrat:r,zamestnanci:i,zdroj:c},m(),v(),d(),e("Údaje byly úspěšně uloženy","success")):e("Prosím vyplňte zdroj dat","warning"):e("Prosím vyplňte alespoň jeden údaj","warning")}function m(){["y3","y2","y1","y0"].forEach((e,t)=>{const n=document.getElementById("btn-year-"+(3-t)),a=document.getElementById("year-status-"+(3-t));n&&a&&(o[e]?(n.classList.add("filled"),a.textContent="✓ Vyplněno"):(n.classList.remove("filled"),a.textContent="Nevyplněno"))})}function v(){const e=document.getElementById("accounting-period-start");if(!e||!e.value)return;const[n]=e.value.split("-").map(e=>parseInt(e,10));if(!(o.y3||o.y2||o.y1||o.y0))return void document.getElementById("data-summary").classList.add("hidden");let a="";[{key:"y3",year:n-3},{key:"y2",year:n-2},{key:"y1",year:n-1},{key:"y0",year:n}].forEach(({key:e,year:n})=>{if(o[e]){const s=o[e];a+=`\n        <div class="summary-item">\n          <div class="summary-year">Rok ${n}:</div>\n          <div class="summary-values">\n            Aktiva: ${t(s.aktiva,0)} Kč | \n            Obrat: ${t(s.obrat,0)} Kč | \n            Zaměstnanci: ${t(s.zamestnanci,0)}<br>\n            <small><em>Zdroj: ${s.zdroj}</em></small>\n          </div>\n        </div>\n      `}}),document.getElementById("summary-content").innerHTML=a,document.getElementById("data-summary").classList.remove("hidden")}function g(){const t=function(){const e=document.getElementById("accounting-period-start").value,t=document.getElementById("unit-name").value.trim(),n=document.getElementById("unit-type").value,a=document.getElementById("unit-ico").value.trim();let s=(new Date).getFullYear();return e&&([s]=e.split("-").map(e=>parseInt(e,10))),{unitName:t,unitType:n,unitICO:a,accountingPeriodStart:e,years:{y3:s-3,y2:s-2,y1:s-1,y0:s},aktiva:{y3:o.y3?o.y3.aktiva:0,y2:o.y2?o.y2.aktiva:0,y1:o.y1?o.y1.aktiva:0,y0:o.y0?o.y0.aktiva:0},obrat:{y3:o.y3?o.y3.obrat:0,y2:o.y2?o.y2.obrat:0,y1:o.y1?o.y1.obrat:0,y0:o.y0?o.y0.obrat:0},zamestnanci:{y3:o.y3?o.y3.zamestnanci:0,y2:o.y2?o.y2.zamestnanci:0,y1:o.y1?o.y1.zamestnanci:0,y0:o.y0?o.y0.zamestnanci:0},zdroje:{y3:o.y3?o.y3.zdroj:"",y2:o.y2?o.y2.zdroj:"",y1:o.y1?o.y1.zdroj:"",y0:o.y0?o.y0.zdroj:""}}}();if(!function(t){return t.unitName&&t.unitType&&t.unitICO?t.accountingPeriodStart?!!(o.y3||o.y2||o.y1||o.y0)||(e("Prosím vyplňte údaje alespoň pro jeden rok","error"),!1):(e("Prosím vyplňte první den účetního období","error"),!1):(e("Vyplňte prosím název, typ a IČO účetní jednotky","error"),!1)}(t))return;const n={micro:{aktiva:9e3,obrat:18e3,zamestnanci:10},small:{aktiva:1e5,obrat:2e5,zamestnanci:50},medium:{aktiva:5e5,obrat:1e6,zamestnanci:250}},s={micro:{aktiva:11e3,obrat:22e3,zamestnanci:10},small:{aktiva:12e4,obrat:24e4,zamestnanci:50},medium:{aktiva:6e5,obrat:12e5,zamestnanci:250}};function l(e,t,a,o){if(null==e&&null==t&&null==a)return null;const l=o>=2024?s:n,r="number"==typeof e?e/1e3:0,i="number"==typeof t?t/1e3:0,c="number"==typeof a?a:0;let y;return y=0,r>=l.micro.aktiva&&y++,i>=l.micro.obrat&&y++,c>=l.micro.zamestnanci&&y++,y<2?"Mikro účetní jednotka":(y=0,r>=l.small.aktiva&&y++,i>=l.small.obrat&&y++,c>=l.small.zamestnanci&&y++,y<2?"Malá účetní jednotka":(y=0,r>=l.medium.aktiva&&y++,i>=l.medium.obrat&&y++,c>=l.medium.zamestnanci&&y++,y<2?"Střední účetní jednotka":"Velká účetní jednotka"))}const r={y3:o.y3?l(t.aktiva.y3,t.obrat.y3,t.zamestnanci.y3,t.years.y3):null,y2:o.y2?l(t.aktiva.y2,t.obrat.y2,t.zamestnanci.y2,t.years.y2):null,y1:o.y1?l(t.aktiva.y1,t.obrat.y1,t.zamestnanci.y1,t.years.y1):null,y0:o.y0?l(t.aktiva.y0,t.obrat.y0,t.zamestnanci.y0,t.years.y0):null},c=new Date(t.accountingPeriodStart)<new Date("2024-01-01");a={data:t,categories:r,thresholdVersion:c?"do 31.12.2023":"od 1.1.2024",thresholds:c?n:s},function(e){const t=f(e.data),n=k(t,e.categories,e.data),a=`\n    <div class="result-item">\n      <span class="result-label">První den účetního období:</span>\n      <span class="result-value">${i(e.data.accountingPeriodStart)}</span>\n    </div>\n    <div class="result-item">\n      <span class="result-label">Použité limity:</span>\n      <span class="result-value">${e.thresholdVersion}</span>\n    </div>\n    <div class="result-item">\n      <span class="result-label">Rok ${e.data.years.y3}:</span>\n      <span class="result-value result-success">${e.categories.y3??"—"}</span>\n      <span class="result-label ml-12">Audit:</span>\n      <span class="result-value">${t.y3}</span>\n    </div>\n    <div class="result-item">\n      <span class="result-label">Rok ${e.data.years.y2}:</span>\n      <span class="result-value result-success">${e.categories.y2??"—"}</span>\n      <span class="result-label ml-12">Audit:</span>\n      <span class="result-value">${t.y2}</span>\n    </div>\n    <div class="result-item">\n      <span class="result-label">Rok ${e.data.years.y1}:</span>\n      <span class="result-value result-success">${e.categories.y1??"—"}</span>\n      <span class="result-label ml-12">Audit:</span>\n      <span class="result-value">${t.y1}</span>\n    </div>\n    <div class="result-item">\n      <span class="result-label">Rok ${e.data.years.y0}:</span>\n      <span class="result-value result-success">${e.categories.y0??"—"}</span>\n      <span class="result-label ml-12">Audit:</span>\n      <span class="result-value">${t.y0}</span>\n    </div>\n        <div class="result-item result-official">\n      <span class="result-label">Pro kontrolovaný rok účetní jednotka je vnímána za:</span>\n      <span class="result-value result-success">${p(e.categories)}</span>\n    </div>\n    <div class="result-item result-official">\n      <span class="result-label">Pro kontrolovaný rok účetní jednotka je povinna k auditu?:</span>\n      <span class="result-value result-success">${n}</span>\n    </div>\n  `;document.getElementById("results-content").innerHTML=a,document.getElementById("results-section").classList.remove("hidden"),document.getElementById("print-section").classList.remove("hidden")}(a),e("Údaje byly úspěšně vyhodnoceny","success")}function p(e){const t=["y3","y2","y1","y0"];if(0===t.map(t=>e[t]).filter(Boolean).length)return"Nedostatek dat";if(e.y2&&e.y1&&e.y2===e.y1)return e.y1;if(e.y3&&e.y2&&e.y3===e.y2)return e.y2;for(let n=0;n<t.length;n++)if(e[t[n]])return e[t[n]];return"Nedostatek dat"}function f(e){const t={aktiva:4e7,obrat:8e7,zamestnanci:50},n={aktiva:12e7,obrat:24e7,zamestnanci:50},a=["Akciová společnost","Svěřenský fond"],o={};return["y3","y2","y1","y0"].forEach(s=>{const l=e.years[s]>=2026?n:t;let r=0;e.aktiva[s]>=l.aktiva&&r++,e.obrat[s]>=l.obrat&&r++,e.zamestnanci[s]>=l.zamestnanci&&r++,a.includes(e.unitType)?o[s]=r>=1?"ANO":"NE":o[s]=r>=2?"ANO":"NE"}),o}function k(e,t,n){return"Malá účetní jednotka"===p(t)?"NE":e.y0&&e.y1&&e.y0===e.y1?e.y0:e.y1&&e.y2&&e.y1===e.y2?e.y1:e.y2&&e.y3&&e.y2===e.y3?e.y2:e.y3?e.y3:e.y0||"Nedostatek dat"}async function b(){if(a)try{await Excel.run(async t=>{const n=t.workbook.getSelectedRange();n.load("address, rowIndex, columnIndex"),await t.sync(),l={address:n.address,rowIndex:n.rowIndex,columnIndex:n.columnIndex};const a=l.rowIndex+31-1,o=l.columnIndex+5-1,s=I(l.columnIndex),r=I(o),i=`${s}${l.rowIndex+1}:${r}${a+1}`;document.getElementById("print-range-text").textContent=i,document.getElementById("print-preview").classList.remove("hidden"),e("Buňka vybrána: "+l.address,"success")})}catch(t){console.error("Error selecting cell:",t),e("Chyba při výběru buňky: "+t.message,"error")}else e("Nejprve vyhodnoťte údaje","warning")}function I(e){let t="",n=e;for(;n>=0;)t=String.fromCharCode(65+n%26)+t,n=Math.floor(n/26)-1;return t}async function E(){if(a)if(l)try{await Excel.run(async t=>{const n=t.workbook.worksheets.getActiveWorksheet(),o=a.data,s=f(o),r=k(s,a.categories),c=[["PROVĚRKA KLIENTA - PARAMETRY","","","",""],["","","","",""],["První den účetního období:",i(o.accountingPeriodStart),"","",""],["Použité limity:",a.thresholdVersion,"","",""],["","","","",""],["FINANČNÍ ÚDAJE","","","",""],["",o.years.y3,o.years.y2,o.years.y1,o.years.y0],["Aktiva (Kč)",o.aktiva.y3,o.aktiva.y2,o.aktiva.y1,o.aktiva.y0],["Obrat (Kč)",o.obrat.y3,o.obrat.y2,o.obrat.y1,o.obrat.y0],["Průměrný počet zaměstnanců",o.zamestnanci.y3,o.zamestnanci.y2,o.zamestnanci.y1,o.zamestnanci.y0],["","","","",""],["ZDROJE DAT","","","",""],[`Rok ${o.years.y3}:`,o.zdroje.y3||"N/A","","",""],[`Rok ${o.years.y2}:`,o.zdroje.y2||"N/A","","",""],[`Rok ${o.years.y1}:`,o.zdroje.y1||"N/A","","",""],[`Rok ${o.years.y0}:`,o.zdroje.y0||"N/A","","",""],["","","","",""],["VYHODNOCENÍ (kategorie dle roku)","Velikost účetní jednotky","Povinnost auditu:","",""],["Rok "+o.years.y3+":",a.categories.y3||"—",s.y3,"",""],["Rok "+o.years.y2+":",a.categories.y2||"—",s.y2,"",""],["Rok "+o.years.y1+":",a.categories.y1||"—",s.y1,"",""],["Rok "+o.years.y0+":",a.categories.y0||"—",s.y0,"",""],["","","","",""],["Datum vytvoření:",(new Date).toLocaleString("cs-CZ"),"","",""]];c.push(["","","","",""]),c.push(["Pro kontrolovaný rok účetní jednotka je vnímána za:",p(a.categories),r,"",""]),c.unshift(["","","","",""]),c.unshift(["KONTROLOVANÁ ÚČETNÍ JEDNOTKA","","","",""]),c.unshift(["Typ:",o.unitType,"","",""]),c.unshift(["IČO:",o.unitICO,"","",""]),c.unshift(["Název:",o.unitName,"","",""]);const y=l.rowIndex,d=l.columnIndex,u=n.getRangeByIndexes(y,d,c.length,5);u.values=c;const m=n.getRangeByIndexes(y+3,d,1,2);m.format.font.bold=!0,m.format.fill.color="#e0e0e0";const v=n.getRangeByIndexes(y+5,d,1,5);v.format.font.bold=!0,v.format.font.size=14,v.format.fill.color="#1CB5A6",v.format.font.color="white";const g=n.getRangeByIndexes(y+10,d,1,5);g.format.font.bold=!0,g.format.font.size=14,g.format.fill.color="#1CB5A6",g.format.font.color="white";const b=n.getRangeByIndexes(y+16,d,1,5);b.format.font.bold=!0,b.format.font.size=14,b.format.fill.color="#1CB5A6",b.format.font.color="white";const I=n.getRangeByIndexes(y+22,d,1,3);I.format.font.bold=!0,I.format.font.size=14,I.format.fill.color="#1CB5A6",I.format.font.color="white";const E=n.getRangeByIndexes(y+11,d,1,5);E.format.font.bold=!0,E.format.fill.color="#e0e0e0",n.getRangeByIndexes(y+12,d+1,1,4).numberFormat=[["#,##0"]],n.getRangeByIndexes(y+13,d+1,1,4).numberFormat=[["#,##0"]],n.getRangeByIndexes(y+14,d+1,1,4).numberFormat=[["#,##0"]],u.format.autofitColumns(),await t.sync(),e("Parametry byly úspěšně vytištěny do listu","success")})}catch(t){console.error("Error printing parameters:",t),e("Chyba při tisku parametrů: "+t.message,"error")}else e("Nejprve vyberte buňku pro tisk","warning");else e("Nejprve vyhodnoťte údaje","warning")}Office.onReady(e=>{e.host===Office.HostType.Excel&&(document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").classList.remove("hidden"),function(){document.getElementById("btn-back-launcher").onclick=()=>{window.location.href="launcher.html"},document.getElementById("btn-restart").onclick=n,document.getElementById("btn-evaluate").onclick=g,document.getElementById("btn-select-cell").onclick=b,document.getElementById("btn-print").onclick=E;const e=document.getElementById("accounting-period-start");if(e){e.addEventListener("change",c);const t=(new Date).getFullYear();e.value||(e.value=`${t}-01-01`),c()}document.getElementById("btn-year-3").onclick=()=>y("y3"),document.getElementById("btn-year-2").onclick=()=>y("y2"),document.getElementById("btn-year-1").onclick=()=>y("y1"),document.getElementById("btn-year-0").onclick=()=>y("y0"),document.getElementById("modal-close").onclick=d,document.getElementById("modal-cancel").onclick=d,document.getElementById("modal-save").onclick=u,document.getElementById("year-modal").onclick=e=>{"year-modal"===e.target.id&&d()},document.querySelectorAll(".formatted-number").forEach(e=>{e.addEventListener("input",function(e){let t=e.target.value.replace(/\s/g,"");t=t.replace(/\D/g,""),e.target.value=t?r(parseInt(t)):""}),e.addEventListener("blur",function(e){let t=e.target.value.replace(/\s/g,"");t&&!isNaN(t)&&(e.target.value=r(parseInt(t)))})})}())})})()})();
//# sourceMappingURL=klient.js.map